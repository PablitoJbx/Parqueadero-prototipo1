<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parqueadero Prototipo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', Arial, sans-serif; margin: 0; background: #eaf0f6; }
    .container { max-width: 600px; margin: 2rem auto; padding: 2rem; background: #fff; border-radius: 16px; box-shadow: 0 4px 24px #0002; }
    .logo {
      display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;
    }
    .logo-icon {
      width: 56px; height: 56px; background: #2980b9; border-radius: 50%; display: flex; align-items: center; justify-content: center;
    }
    .logo-icon svg { width: 36px; height: 36px; fill: #fff; }
    .logo-title { font-size: 2rem; font-weight: 700; color: #2980b9; letter-spacing: 1px; }
    h2 { color: #2c3e50; margin-top: 2rem; }
    form, .vehiculos { background: #f8fafc; padding: 1.5rem; margin-bottom: 2rem; border-radius: 12px; box-shadow: 0 2px 8px #0001; }
    label { display: block; margin-top: 1rem; font-weight: 500; }
    input, select { padding: 0.5rem; margin-top: 0.5rem; width: 100%; border-radius: 6px; border: 1px solid #b0c4d6; font-size: 1rem; }
    button { margin-top: 1rem; padding: 0.7rem 1.5rem; background: #2980b9; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: background 0.2s; }
    button:hover { background: #3498db; }
    .error, .success { margin-top: 1rem; font-size: 1rem; font-weight: 600; }
    .error { color: #e74c3c; }
    .success { color: #27ae60; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.7rem; border-bottom: 1px solid #dbe6f3; text-align: center; }
    th { background: #2980b9; color: #fff; font-weight: 700; }
    tr:last-child td { border-bottom: none; }
    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid #2980b9;
      border-top: 3px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      vertical-align: middle;
      margin-right: 8px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 700px) {
      .container { padding: 1rem; }
      .logo-title { font-size: 1.3rem; }
    }
    .login-register {
      background: #f8fafc;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px #0001;
      margin-bottom: 2rem;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    .login-register h2 { margin-top: 0; }
    .parking-map {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      gap: 16px;
      justify-content: center;
      margin: 2rem 0;
    }
    .space {
      width: 60px; height: 80px;
      background: #dbe6f3;
      border-radius: 8px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      box-shadow: 0 2px 6px #0001;
      cursor: pointer;
      position: relative;
      transition: background 0.2s;
    }
    .space.occupied { background: #e74c3c; color: #fff; }
    .space.selected { background: #2980b9; color: #fff; }
    .space .placa { font-size: 0.9rem; font-weight: bold; margin-top: 0.3rem; }
    .space .tipo { font-size: 0.8rem; }
    .space .actions { margin-top: 0.5rem; display: flex; gap: 4px; }
    .space button { padding: 0.2rem 0.5rem; font-size: 0.8rem; border-radius: 4px; border: none; cursor: pointer; }
    .space button.add { background: #27ae60; color: #fff; }
    .space button.remove { background: #e67e22; color: #fff; }
    .space button:disabled { background: #ccc; color: #fff; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <div class="logo-icon">
        <!-- Simple parking logo SVG -->
        <svg viewBox="0 0 48 48"><circle cx="24" cy="24" r="22" fill="#fff"/><rect x="14" y="14" width="20" height="20" rx="6" fill="#2980b9"/><text x="24" y="32" text-anchor="middle" font-size="18" fill="#fff" font-family="Arial" font-weight="bold">P</text></svg>
      </div>
      <span class="logo-title">Parqueadero Prototipo</span>
    </div>
    <div class="login-register" id="authBox">
      <h2 id="authTitle">Iniciar Sesión</h2>
      <form id="loginForm">
        <label>Usuario:
          <input type="text" id="loginUser" required autocomplete="off">
        </label>
        <label>Contraseña:
          <input type="password" id="loginPass" required>
        </label>
        <button type="submit">Entrar</button>
        <div id="loginMsg"></div>
      </form>
      <div style="margin-top:1rem; text-align:center;">
        <a href="#" id="showRegister">¿No tienes cuenta? Regístrate</a>
      </div>
      <form id="registerForm" style="display:none; margin-top:1.5rem;">
        <h2>Registro</h2>
        <label>Usuario:
          <input type="text" id="registerUser" required autocomplete="off">
        </label>
        <label>Contraseña:
          <input type="password" id="registerPass" required>
        </label>
        <button type="submit">Registrar</button>
        <div id="registerMsg"></div>
        <div style="margin-top:1rem; text-align:center;">
          <a href="#" id="showLogin">¿Ya tienes cuenta? Inicia sesión</a>
        </div>
      </form>
    </div>
    <div id="mainApp" style="display:none;">
      <h2 style="text-align:center;">Mapa del Parqueadero</h2>
      <div class="parking-map" id="parkingMap"></div>
      <div id="parkingMsg" style="text-align:center;"></div>
    </div>
  </div>
  <script>
    const api = ''; // Si frontend y backend están juntos, dejar vacío. Si están separados, poner la URL del backend.
    function mostrarCargando(msg) {
      document.getElementById('tablaMsg').innerHTML = `<span class="spinner"></span>${msg}`;
      document.getElementById('tablaMsg').className = 'success';
    }
    async function cargarVehiculos() {
      mostrarCargando('Cargando vehículos...');
      try {
        const res = await fetch(api + '/parqueadero');
        if (!res.ok) throw new Error('No se pudo cargar');
        const vehiculos = await res.json();
        const tbody = document.querySelector('#tablaVehiculos tbody');
        tbody.innerHTML = '';
        if (vehiculos.length === 0) {
          document.getElementById('tablaMsg').textContent = 'No hay vehículos en el parqueadero.';
          document.getElementById('tablaMsg').className = '';
        } else {
          document.getElementById('tablaMsg').textContent = '';
          vehiculos.forEach((v, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${v.placa}</td><td>${v.tipo}</td><td>${new Date(v.horaEntrada).toLocaleString()}</td>`;
            tr.style.opacity = 0;
            setTimeout(() => { tr.style.transition = 'opacity 0.5s'; tr.style.opacity = 1; }, 100 * i);
            tbody.appendChild(tr);
          });
        }
      } catch (err) {
        document.getElementById('tablaMsg').textContent = 'Error al cargar vehículos.';
        document.getElementById('tablaMsg').className = 'error';
      }
    }
    document.getElementById('entradaForm').onsubmit = async e => {
      e.preventDefault();
      const placa = document.getElementById('placaEntrada').value.trim().toUpperCase();
      const tipo = document.getElementById('tipoEntrada').value;
      const msg = document.getElementById('entradaMsg');
      msg.textContent = '';
      msg.className = '';
      if (!placa.match(/^[A-Z0-9]{5,10}$/)) {
        msg.textContent = 'Placa inválida. Debe tener entre 5 y 10 caracteres alfanuméricos.';
        msg.className = 'error';
        return;
      }
      try {
        msg.textContent = 'Registrando...';
        msg.className = 'success';
        const res = await fetch(api + '/entrada', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ placa, tipo })
        });
        if (res.ok) {
          msg.textContent = 'Vehículo registrado correctamente.';
          msg.className = 'success';
          cargarVehiculos();
          e.target.reset();
        } else {
          const data = await res.json();
          msg.textContent = data.error || 'Error al registrar entrada.';
          msg.className = 'error';
        }
      } catch {
        msg.textContent = 'Error de red al registrar entrada.';
        msg.className = 'error';
      }
    };
    document.getElementById('salidaForm').onsubmit = async e => {
      e.preventDefault();
      const placa = document.getElementById('placaSalida').value.trim().toUpperCase();
      const msg = document.getElementById('salidaMsg');
      msg.textContent = '';
      msg.className = '';
      if (!placa.match(/^[A-Z0-9]{5,10}$/)) {
        msg.textContent = 'Placa inválida. Debe tener entre 5 y 10 caracteres alfanuméricos.';
        msg.className = 'error';
        return;
      }
      try {
        msg.textContent = 'Procesando salida...';
        msg.className = 'success';
        const res = await fetch(api + '/salida', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ placa })
        });
        if (res.ok) {
          msg.textContent = 'Salida registrada correctamente.';
          msg.className = 'success';
          cargarVehiculos();
          e.target.reset();
        } else {
          const data = await res.json();
          msg.textContent = data.error || 'Error al registrar salida.';
          msg.className = 'error';
        }
      } catch {
        msg.textContent = 'Error de red al registrar salida.';
        msg.className = 'error';
      }
    };
    // --- Login/Register logic ---
    let currentUser = null;
    document.getElementById('showRegister').onclick = e => {
      e.preventDefault();
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('registerForm').style.display = '';
      document.getElementById('authTitle').textContent = 'Registro';
    };
    document.getElementById('showLogin').onclick = e => {
      e.preventDefault();
      document.getElementById('loginForm').style.display = '';
      document.getElementById('registerForm').style.display = 'none';
      document.getElementById('authTitle').textContent = 'Iniciar Sesión';
    };
    document.getElementById('loginForm').onsubmit = e => {
      e.preventDefault();
      // Simulación de login (sin backend real)
      const user = document.getElementById('loginUser').value;
      const pass = document.getElementById('loginPass').value;
      if (localStorage.getItem('user_' + user) === pass) {
        currentUser = user;
        document.getElementById('authBox').style.display = 'none';
        document.getElementById('mainApp').style.display = '';
        renderParkingMap();
      } else {
        document.getElementById('loginMsg').textContent = 'Usuario o contraseña incorrectos';
        document.getElementById('loginMsg').className = 'error';
      }
    };
    document.getElementById('registerForm').onsubmit = e => {
      e.preventDefault();
      const user = document.getElementById('registerUser').value;
      const pass = document.getElementById('registerPass').value;
      if (localStorage.getItem('user_' + user)) {
        document.getElementById('registerMsg').textContent = 'El usuario ya existe';
        document.getElementById('registerMsg').className = 'error';
      } else {
        localStorage.setItem('user_' + user, pass);
        document.getElementById('registerMsg').textContent = 'Usuario registrado. Ahora puedes iniciar sesión.';
        document.getElementById('registerMsg').className = 'success';
      }
    };
    // --- Parking map logic ---
    const NUM_SPACES = 15;
    let parkingSpaces = Array(NUM_SPACES).fill(null);
    function renderParkingMap() {
      const map = document.getElementById('parkingMap');
      map.innerHTML = '';
      parkingSpaces.forEach((car, idx) => {
        const div = document.createElement('div');
        div.className = 'space' + (car ? ' occupied' : '');
        if (car) {
          div.innerHTML = `<span class="placa">${car.placa}</span><span class="tipo">${car.tipo}</span><div class="actions"><button class="remove">Sacar</button></div>`;
          div.querySelector('.remove').onclick = () => {
            parkingSpaces[idx] = null;
            renderParkingMap();
            document.getElementById('parkingMsg').textContent = `Vehículo retirado del espacio ${idx+1}`;
          };
        } else {
          div.innerHTML = `<div class="actions"><button class="add">Agregar</button></div>`;
          div.querySelector('.add').onclick = () => {
            const placa = prompt('Placa del vehículo:').toUpperCase();
            const tipo = prompt('Tipo (carro/moto):').toLowerCase();
            if (!placa.match(/^[A-Z0-9]{5,10}$/) || (tipo !== 'carro' && tipo !== 'moto')) {
              alert('Datos inválidos.');
              return;
            }
            parkingSpaces[idx] = { placa, tipo };
            renderParkingMap();
            document.getElementById('parkingMsg').textContent = `Vehículo agregado al espacio ${idx+1}`;
          };
        }
        map.appendChild(div);
      });
    }
    cargarVehiculos();
    setInterval(cargarVehiculos, 10000);
    // Mostrar login/register al cargar
    document.getElementById('authBox').style.display = '';
    document.getElementById('mainApp').style.display = 'none';
  </script>
</body>
</html>
