<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parqueadero Prototipo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', Arial, sans-serif; margin: 0; background: #eaf0f6; }
    .container { max-width: 600px; margin: 2rem auto; padding: 2rem; background: #fff; border-radius: 16px; box-shadow: 0 4px 24px #0002; }
    .logo {
      display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;
    }
    .logo-icon {
      width: 56px; height: 56px; background: #2980b9; border-radius: 50%; display: flex; align-items: center; justify-content: center;
    }
    .logo-icon svg { width: 36px; height: 36px; fill: #fff; }
    .logo-title { font-size: 2rem; font-weight: 700; color: #2980b9; letter-spacing: 1px; }
    h2 { color: #2c3e50; margin-top: 2rem; }
    form, .vehiculos { background: #f8fafc; padding: 1.5rem; margin-bottom: 2rem; border-radius: 12px; box-shadow: 0 2px 8px #0001; }
    label { display: block; margin-top: 1rem; font-weight: 500; }
    input, select { padding: 0.5rem; margin-top: 0.5rem; width: 100%; border-radius: 6px; border: 1px solid #b0c4d6; font-size: 1rem; }
    button { margin-top: 1rem; padding: 0.7rem 1.5rem; background: #2980b9; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: background 0.2s; }
    button:hover { background: #3498db; }
    .error, .success { margin-top: 1rem; font-size: 1rem; font-weight: 600; }
    .error { color: #e74c3c; }
    .success { color: #27ae60; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.7rem; border-bottom: 1px solid #dbe6f3; text-align: center; }
    th { background: #2980b9; color: #fff; font-weight: 700; }
    tr:last-child td { border-bottom: none; }
    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid #2980b9;
      border-top: 3px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      vertical-align: middle;
      margin-right: 8px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 700px) {
      .container { padding: 1rem; }
      .logo-title { font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <div class="logo-icon">
        <!-- Simple parking logo SVG -->
        <svg viewBox="0 0 48 48"><circle cx="24" cy="24" r="22" fill="#fff"/><rect x="14" y="14" width="20" height="20" rx="6" fill="#2980b9"/><text x="24" y="32" text-anchor="middle" font-size="18" fill="#fff" font-family="Arial" font-weight="bold">P</text></svg>
      </div>
      <span class="logo-title">Parqueadero Prototipo</span>
    </div>
    <form id="entradaForm">
      <h2>Registrar Entrada</h2>
      <label>Placa:
        <input type="text" id="placaEntrada" required maxlength="10" autocomplete="off">
      </label>
      <label>Tipo:
        <select id="tipoEntrada" required>
          <option value="carro">Carro</option>
          <option value="moto">Moto</option>
        </select>
      </label>
      <button type="submit">Registrar Entrada</button>
      <div id="entradaMsg"></div>
    </form>
    <form id="salidaForm">
      <h2>Registrar Salida</h2>
      <label>Placa:
        <input type="text" id="placaSalida" required maxlength="10" autocomplete="off">
      </label>
      <button type="submit">Registrar Salida</button>
      <div id="salidaMsg"></div>
    </form>
    <div class="vehiculos">
      <h2>Vehículos en el Parqueadero</h2>
      <table id="tablaVehiculos">
        <thead>
          <tr><th>Placa</th><th>Tipo</th><th>Hora Entrada</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="tablaMsg"></div>
    </div>
  </div>
  <script>
    const api = ''; // Si frontend y backend están juntos, dejar vacío. Si están separados, poner la URL del backend.
    function mostrarCargando(msg) {
      document.getElementById('tablaMsg').innerHTML = `<span class="spinner"></span>${msg}`;
      document.getElementById('tablaMsg').className = 'success';
    }
    async function cargarVehiculos() {
      mostrarCargando('Cargando vehículos...');
      try {
        const res = await fetch(api + '/parqueadero');
        if (!res.ok) throw new Error('No se pudo cargar');
        const vehiculos = await res.json();
        const tbody = document.querySelector('#tablaVehiculos tbody');
        tbody.innerHTML = '';
        if (vehiculos.length === 0) {
          document.getElementById('tablaMsg').textContent = 'No hay vehículos en el parqueadero.';
          document.getElementById('tablaMsg').className = '';
        } else {
          document.getElementById('tablaMsg').textContent = '';
          vehiculos.forEach((v, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${v.placa}</td><td>${v.tipo}</td><td>${new Date(v.horaEntrada).toLocaleString()}</td>`;
            tr.style.opacity = 0;
            setTimeout(() => { tr.style.transition = 'opacity 0.5s'; tr.style.opacity = 1; }, 100 * i);
            tbody.appendChild(tr);
          });
        }
      } catch (err) {
        document.getElementById('tablaMsg').textContent = 'Error al cargar vehículos.';
        document.getElementById('tablaMsg').className = 'error';
      }
    }
    document.getElementById('entradaForm').onsubmit = async e => {
      e.preventDefault();
      const placa = document.getElementById('placaEntrada').value.trim().toUpperCase();
      const tipo = document.getElementById('tipoEntrada').value;
      const msg = document.getElementById('entradaMsg');
      msg.textContent = '';
      msg.className = '';
      if (!placa.match(/^[A-Z0-9]{5,10}$/)) {
        msg.textContent = 'Placa inválida. Debe tener entre 5 y 10 caracteres alfanuméricos.';
        msg.className = 'error';
        return;
      }
      try {
        msg.textContent = 'Registrando...';
        msg.className = 'success';
        const res = await fetch(api + '/entrada', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ placa, tipo })
        });
        if (res.ok) {
          msg.textContent = 'Vehículo registrado correctamente.';
          msg.className = 'success';
          cargarVehiculos();
          e.target.reset();
        } else {
          const data = await res.json();
          msg.textContent = data.error || 'Error al registrar entrada.';
          msg.className = 'error';
        }
      } catch {
        msg.textContent = 'Error de red al registrar entrada.';
        msg.className = 'error';
      }
    };
    document.getElementById('salidaForm').onsubmit = async e => {
      e.preventDefault();
      const placa = document.getElementById('placaSalida').value.trim().toUpperCase();
      const msg = document.getElementById('salidaMsg');
      msg.textContent = '';
      msg.className = '';
      if (!placa.match(/^[A-Z0-9]{5,10}$/)) {
        msg.textContent = 'Placa inválida. Debe tener entre 5 y 10 caracteres alfanuméricos.';
        msg.className = 'error';
        return;
      }
      try {
        msg.textContent = 'Procesando salida...';
        msg.className = 'success';
        const res = await fetch(api + '/salida', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ placa })
        });
        if (res.ok) {
          msg.textContent = 'Salida registrada correctamente.';
          msg.className = 'success';
          cargarVehiculos();
          e.target.reset();
        } else {
          const data = await res.json();
          msg.textContent = data.error || 'Error al registrar salida.';
          msg.className = 'error';
        }
      } catch {
        msg.textContent = 'Error de red al registrar salida.';
        msg.className = 'error';
      }
    };
    cargarVehiculos();
    setInterval(cargarVehiculos, 10000);
  </script>
</body>
</html>
